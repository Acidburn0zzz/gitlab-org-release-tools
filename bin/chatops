#!/bin/sh

set -e

require_version()
{
  if [ -z "${RELEASE_VERSION}" ]; then
    echo "RELEASE_VERSION required!"
    exit 1
  fi
}

setup_env()
{
  export GITLAB_API_PRIVATE_TOKEN="$RELEASE_BOT_PRODUCTION_TOKEN"
  export DEV_API_PRIVATE_TOKEN="$RELEASE_BOT_DEV_TOKEN"
}

require_version
setup_env

case $1 in
  "qa_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "qa_issue[$RELEASE_VERSION]"
    ;;
  "release")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "release[$RELEASE_VERSION]"
    ;;
  "security_release")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "security_release[$RELEASE_VERSION]"
    ;;
esac
