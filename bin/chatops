#!/bin/sh

set -e

require_version()
{
  if [ -z "${RELEASE_VERSION}" ]; then
    echo "RELEASE_VERSION required!"
    exit 1
  fi
}

setup_env()
{
  export GITLAB_API_PRIVATE_TOKEN="$RELEASE_BOT_PRODUCTION_TOKEN"
  export DEV_API_PRIVATE_TOKEN="$RELEASE_BOT_DEV_TOKEN"
}

require_version
setup_env

case $1 in
  "cherry_pick")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "monthly_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "patch_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "publish")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "qa_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "security_cherry_pick")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "security_patch_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "security_qa_issue")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "tag")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  "tag_security")
    bundle exec rake "release_managers:auth[$RELEASE_USER]" "$1[$RELEASE_VERSION]"
    ;;
  *)
    echo "Don't know what to do with $1!"
    exit 1
    ;;
esac
